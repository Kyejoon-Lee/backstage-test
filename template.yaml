apiVersion: scaffolder.backstage.io/v1beta3
# https://backstage.io/docs/features/software-catalog/descriptor-format#kind-template
kind: Template
metadata:
  name: helm-upload-template
  title: Helm Upload Template
  description: An example template for the scaffolder that uploads a Helm chart to a Git repository
  namespace: default
spec:
  owner: group:default/guests
  type: service
  parameters:
    - title: Chart Information
      required:
        - name
        - description
      properties:
        name:
          title: Chart Name
          type: string
          description: Unique name of the Helm chart
          ui:autofocus: true
        description:
          title: Chart Description
          type: string
          description: Description of what this Helm chart does
        version:
          title: Chart Version
          type: string
          description: Version of the chart
          default: "0.1.0"
    - title: Application Configuration
      required:
        - imageRepository
      properties:
        imageRepository:
          title: Container Image Repository
          type: string
          description: Container image repository (e.g., nginx, myapp/backend)
          default: "nginx"
        imageTag:
          title: Image Tag
          type: string
          description: Container image tag
          default: "latest"
        replicaCount:
          title: Replica Count
          type: integer
          description: Number of replicas to deploy
          default: 1
          minimum: 1
          maximum: 10
    - title: Choose a location
      required:
        - repoUrl
      properties:
        repoUrl:
          title: Repository Location
          type: string
          ui:field: RepoUrlPicker
          ui:options:
            allowedHosts:
              - github.com

  steps:
    - id: fetch-base
      name: Fetch Base
      action: fetch:template
      input:
        url: ./starter
        values:
          name: ${{ parameters.name }}
          description: ${{ parameters.description }}
          version: ${{ parameters.version }}
          imageRepository: ${{ parameters.imageRepository }}
          imageTag: ${{ parameters.imageTag }}
          replicaCount: ${{ parameters.replicaCount }}

    - id: publish
      name: Publish
      action: publish:github
      input:
        allowedHosts: ['github.com']
        description: ${{ parameters.description }}
        repoUrl: ${{ parameters.repoUrl }}

  output:
    links:
      - title: Repository
        url: ${{ steps['publish'].output.remoteUrl }}
      - title: Open in catalog
        icon: catalog
        entityRef: ${{ steps['publish'].output.catalogInfoUrl }}
